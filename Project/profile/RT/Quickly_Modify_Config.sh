#! /bin/sh

########### KERNEL CONFIG ##############
DSL_N10_C1_CONFIG="./dsl-n10-c1/kernel.config"
DSL_N12E_C1_CONFIG="./dsl-n12e-c1/kernel.config"
DSL_N10_D1_CONFIG="./dsl-n10-d1/kernel.config"
DSL_N12U_C1_CONFIG="./dsl-n12u-c1/kernel.config"
DSL_N12U_D1_CONFIG="./dsl-n12u-d1/kernel.config"
DSL_N14U_CONFIG="./dsl-n14u/kernel.config"
DSL_N14U_B1_CONFIG="./dsl-n14u-b1/kernel.config"
DSL_N16_CONFIG="./dsl-n16/kernel_36.config"
DSL_AC51_CONFIG="./dsl-ac51/kernel_36.config"
DSL_N16P_CONFIG="./dsl-n16p/kernel_36.config"
DSL_N16U_CONFIG="./dsl-n16u/kernel.config"
DSL_N17U_CONFIG="./dsl-n17u/kernel_36.config"
DSL_N55U_C1_CONFIG="./dsl-n55u-c1/kernel.config"
DSL_N55U_D1_CONFIG="./dsl-n55u-d1/kernel.config"
DSL_N66U_CONFIG="./dsl-n66u/kernel.config"
DSL_AC52U_CONFIG="./dsl-ac52u/kernel_36.config"
DSL_AC55U_CONFIG="./dsl-ac55u/kernel_36.config"
DSL_AC56U_CONFIG="./dsl-ac56u/kernel_36.config"
#DSL_N10_C1_POL_CONFIG="./dsl-n10-c1_pol/kernel.config"
#DSL_N10_C1_DODO_CONFIG="dsl-n10-c1_dodo/kernel.config"
#DSL_N12U_C1_DODO_CONFIG="dsl-n12u-c1_dodo/kernel.config"
#DSL_N12E_C1_DODO_CONFIG="dsl-n12e-c1_dodo/kernel.config"
#DSL_N14U_WIND_CONFIG="dsl-n14u_wind/kernel.config"
#DSL_N66U_ELISA_CONFIG="dsl-n66u_elisa/kernel.config"
########### CONFIG ##############

########### NEW CONFIG ##############
DSL_N10_C1_NEW_CONFIG="./dsl-n10-c1/new.config"
DSL_N12E_C1_NEW_CONFIG="./dsl-n12e-c1/new.config"
DSL_N10_D1_NEW_CONFIG="./dsl-n10-d1/new.config"
DSL_N12U_C1_NEW_CONFIG="./dsl-n12u-c1/new.config"
DSL_N12U_D1_NEW_CONFIG="./dsl-n12u-d1/new.config"
DSL_N14U_NEW_CONFIG="./dsl-n14u/new.config"
DSL_N14U_B1_NEW_CONFIG="./dsl-n14u-b1/new.config"
DSL_N16_NEW_CONFIG="./dsl-n16/new.config"
DSL_AC51_NEW_CONFIG="./dsl-ac51/new.config"
DSL_N16P_NEW_CONFIG="./dsl-n16p/new.config"
DSL_N16U_NEW_CONFIG="./dsl-n16u/new.config"
DSL_N17U_NEW_CONFIG="./dsl-n17u/new.config"
DSL_N55U_C1_NEW_CONFIG="./dsl-n55u-c1/new.config"
DSL_N55U_D1_NEW_CONFIG="./dsl-n55u-d1/new.config"
DSL_N66U_NEW_CONFIG="./dsl-n66u/new.config"
DSL_AC52U_NEW_CONFIG="./dsl-ac52u/new.config"
DSL_AC55U_NEW_CONFIG="./dsl-ac55u/new.config"
DSL_AC56U_NEW_CONFIG="./dsl-ac56u/new.config"
#DSL_N10_C1_POL_NEW_CONFIG="./dsl-n10-c1_pol/new.config"
#DSL_N10_C1_DODO_NEW_CONFIG="dsl-n10-c1_dodo/new.config"
#DSL_N12E_C1_DODO_NEW_CONFIG="dsl-n12e-c1_dodo/new.config"
#DSL_N12U_C1_DODO_NEW_CONFIG="dsl-n12u-c1_dodo/new.config"
#DSL_N14U_WIND_NEW_CONFIG="dsl-n14u_wind/new.config"
#DSL_N66U_ELISA_NEW_CONFIG="dsl-n66u_elisa/new.config"
########### NEW CONFIG ##############

########### PROFILE ##############
DSL_N10_C1_PROFILE="./dsl-n10-c1/dsl-n10-c1.profile"
DSL_N12E_C1_PROFILE="./dsl-n12e-c1/dsl-n12e-c1.profile"
DSL_N10_D1_PROFILE="./dsl-n10-d1/dsl-n10-d1.profile"
DSL_N12U_C1_PROFILE="./dsl-n12u-c1/dsl-n12u-c1.profile"
DSL_N12U_D1_PROFILE="./dsl-n12u-d1/dsl-n12u-d1.profile"
DSL_N14U_PROFILE="./dsl-n14u/dsl-n14u.profile"
DSL_N14U_B1_PROFILE="./dsl-n14u-b1/dsl-n14u-b1.profile"
DSL_N16_PROFILE="./dsl-n16/dsl-n16_2_6_36.profile"
DSL_AC51_PROFILE="./dsl-ac51/dsl-ac51_2_6_36.profile"
DSL_N16P_PROFILE="./dsl-n16p/dsl-n16p_2_6_36.profile"
DSL_N16U_PROFILE="./dsl-n16u/dsl-n16u.profile"
DSL_N17U_PROFILE="./dsl-n17u/dsl-n17u_2_6_36.profile"
DSL_N55U_C1_PROFILE="./dsl-n55u-c1/dsl-n55u-c1.profile"
DSL_N55U_D1_PROFILE="./dsl-n55u-d1/dsl-n55u-d1.profile"
DSL_N66U_PROFILE="./dsl-n66u/dsl-n66u.profile"
DSL_AC52U_PROFILE="./dsl-ac52u/dsl-ac52u_2_6_36.profile"
DSL_AC55U_PROFILE="./dsl-ac55u/dsl-ac55u_2_6_36.profile"
DSL_AC56U_PROFILE="./dsl-ac56u/dsl-ac56u_2_6_36.profile"
#DSL_N10_C1_POL_PROFILE="./dsl-n10-c1_pol/dsl-n10-c1_pol.profile"
#DSL_N10_C1_DODO_PROFILE="dsl-n10-c1_dodo/dsl-n10-c1_dodo.profile"
#DSL_N12U_C1_DODO_PROFILE="dsl-n12u-c1_dodo/dsl-n12u-c1_dodo.profile"
#DSL_N12E_C1_DODO_PROFILE="dsl-n12e-c1_dodo/dsl-n12e-c1_dodo.profile"
#DSL_N14U_WIND_PROFILE="dsl-n14u_wind/dsl-n14u_wind.profile"
#DSL_N66U_ELISA_PROFILE="dsl-n66u_elisa/dsl-n66u_elisa.profile"
########### PROFILE ##############

########### NEW PROFILE ##############
DSL_N10_C1_NEW_PROFILE="./dsl-n10-c1/new.profile"
DSL_N12E_C1_NEW_PROFILE="./dsl-n12e-c1/new.profile"
DSL_N10_D1_NEW_PROFILE="./dsl-n10-d1/new.profile"
DSL_N12U_C1_NEW_PROFILE="./dsl-n12u-c1/new.profile"
DSL_N12U_D1_NEW_PROFILE="./dsl-n12u-d1/new.profile"
DSL_N14U_NEW_PROFILE="./dsl-n14u/new.profile"
DSL_N14U_B1_NEW_PROFILE="./dsl-n14u-b1/new.profile"
DSL_N16_NEW_PROFILE="./dsl-n16/new.profile"
DSL_AC51_NEW_PROFILE="./dsl-ac51/new.profile"
DSL_N16P_NEW_PROFILE="./dsl-n16p/new.profile"
DSL_N16U_NEW_PROFILE="./dsl-n16u/new.profile"
DSL_N17U_NEW_PROFILE="./dsl-n17u/new.profile"
DSL_N55U_C1_NEW_PROFILE="./dsl-n55u-c1/new.profile"
DSL_N55U_D1_NEW_PROFILE="./dsl-n55u-d1/new.profile"
DSL_N66U_NEW_PROFILE="./dsl-n66u/new.profile"
DSL_AC52U_NEW_PROFILE="./dsl-ac52u/new.profile"
DSL_AC55U_NEW_PROFILE="./dsl-ac55u/new.profile"
DSL_AC56U_NEW_PROFILE="./dsl-ac56u/new.profile"
#DSL_N10_C1_POL_NEW_PROFILE="./dsl-n10-c1_pol/new.profile"
#DSL_N10_C1_DODO_NEW_PROFILE="dsl-n10-c1_dodo/new.profile"
#DSL_N12E_C1_DODO_NEW_PROFILE="dsl-n12e-c1_dodo/new.profile"
#DSL_N12U_C1_DODO_NEW_PROFILE="dsl-n12u-c1_dodo/new.profile"
#DSL_N14U_WIND_NEW_PROFILE="dsl-n14u_wind/new.profile"
#DSL_N66U_ELISA_NEW_PROFILE="dsl-n66u_elisa/new.profile"
########### NEW PROFILE ##############

MODULE_LIST="./module_list.conf"

usage()
{
	echo "Usage: $0 [0:kernel|1:profile] [0:Disable|1:Enable] "CONFIG""
	echo "Example:"
	echo "         $0 "\"0\"" "\"1\"" "\"CONFIG_NETFILTER_XT_MATCH_PKTTYPE\"""
	echo ""
}

if [ $# != 3 ]; then
	usage
	exit;
else
	if [ $1 != 0 ] && [ $1 != 1 ]; then
		usage
		exit;
	fi
	if [ $2 != 0 ] && [ $2 != 1 ]; then
		usage
		exit;
	fi
	TYPE=$1
	ENABLE="$2"
	ENTER_CONFIG="$3"
fi

rm ./report

MODULE_DATA=(`grep ^MODULE_LIST= $MODULE_LIST | cut -d= -f2 | sed 's/;/ /g'`)

for ((index=0; index<${#MODULE_DATA[@]}; index++)); do
	#echo "MOUDLE_DATA[$index] => ${MODULE_DATA[$index]}"
	if [ $TYPE == 0 ]; then
		eval CONFIG="$"${MODULE_DATA[$index]}_CONFIG""
		eval NEW_CONFIG="$"${MODULE_DATA[$index]}_NEW_CONFIG""
	else
		eval CONFIG="$"${MODULE_DATA[$index]}_PROFILE""
		eval NEW_CONFIG="$"${MODULE_DATA[$index]}_NEW_PROFILE""
	fi
	#echo ${CONFIG}
	#echo ${NEW_CONFIG}
	SET_CONFIG=${ENTER_CONFIG}"=y"
	UNSET_CONFIG="# "${ENTER_CONFIG}" is not set"
	#echo ${SET_CONFIG}
	#echo ${UNSET_CONFIG}
	if [ $ENABLE == 1 ]; then
		cat $CONFIG | sed s/"${UNSET_CONFIG}"/"${SET_CONFIG}/" > $NEW_CONFIG
	elif [ $ENABLE == 0 ]; then
		cat $CONFIG | sed s/"${SET_CONFIG}"/"${UNSET_CONFIG}/" > $NEW_CONFIG
	fi
	echo "######${MODULE_DATA[$index]}######" >> ./report
	diff $NEW_CONFIG $CONFIG >> ./report
	mv $NEW_CONFIG $CONFIG
	echo "${MODULE_DATA[$index]} Done!!"
done
